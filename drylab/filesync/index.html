<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/jtd.css"> <link rel=icon  href="/assets/favicon.ico"> <title>File Sync and Backup</title> <div class=page-wrap > <div class=side-bar > <div class=header > <a href="/" class=title > VKC Lab Protocols </a> </div> <label for=show-menu  class=show-menu >MENU</label> <input type=checkbox  id=show-menu  role=button > <div class=menu  id=side-menu > <ul class=menu-list > <li class="menu-list-item "><a href="/" class="menu-list-link ">Home</a> <li class="menu-list-item "><a href="/wetlab/" class="menu-list-link ">Wet Lab Protocols</a> <li class="menu-list-item active"><a href="/drylab/" class="menu-list-link ">Dry Lab Protocols</a> <li class="menu-list-item "><a href="/handbook/" class="menu-list-link ">Lab Handbook</a> <ul class="menu-list-child-list "> <li class="menu-list-item "><a href="#" class=menu-list-link >Submenu</a> </ul> </ul> </div> <div class=footer > This is <em>Just the docs</em>, adapted from the <a href="https://github.com/pmarsceill/just-the-docs" target=_blank >Jekyll theme</a>. </div> </div> <div class=main-content-wrap > <div class=main-content > <div class=main-header > <a id=github  href="//github.com/tlienart/Franklin.jl">Franklin on GitHub</a> </div> <div class=franklin-content > <h1 id=file_sync_and_backup ><a href="#file_sync_and_backup" class=header-anchor >File Sync and Backup</a></h1> <p>All of the primary <a href="computers/">lab drives</a> are regularly synced to the cloud using google drive &#40;since we have unlimited storage there&#41;.</p> <p>There is a &#91;Shared Drive&#93;<sup id="fnref:shareddrive"><a href="#fndef:shareddrive" class=fnref >[1]</a></sup> on google drive for backed up directories.</p> <h2 id=setting_up_duplicity ><a href="#setting_up_duplicity" class=header-anchor >Setting up duplicity</a></h2> <p><code>duplicty</code><sup id="fnref:duplicity"><a href="#fndef:duplicity" class=fnref >[2]</a></sup> is a command-line tool that enables encrypted and incremental backup with a number of different services, including google drive &#40;which is important, since we have unlimmited storage on Wellesley&#39;s gdrive&#41;.</p> <h3 id=set_up_google_api_and_duplicitysup_idfnrefdupgdrivea_hreffndefdupgdrive_classfnref3 ><a href="#set_up_google_api_and_duplicitysup_idfnrefdupgdrivea_hreffndefdupgdrive_classfnref3" class=header-anchor >Set up google api and duplicity<sup id="fnref:dupgdrive"><a href="#fndef:dupgdrive" class=fnref >[3]</a></sup></a></h3> <p>There are a bunch of guides online<sup id="fnref:dupgdrive"><a href="#fndef:dupgdrive" class=fnref >[3]</a></sup> to setting up google drive as a backend for <code>duplicity</code>. The basic procedure is</p> <ol> <li><p>Make yourself an app using google developer console that has the ability to manage gdrive folders &#40;I was able to make one that only had read/write permission on its own folders&#41;</p> <li><p>Get the credentials, and save them in a file on your local drive. I used <code>pass</code><sup id="fnref:pass"><a href="#fndef:pass" class=fnref >[4]</a></sup> to encrypt these credentials.</p> <li><p>Make sure to install right versions of python deps<sup id="fnref:pydrive"><a href="#fndef:pydrive" class=fnref >[5]</a></sup> - you need <code>httplib2</code> v.0.15.0 and <code>google-api-python-client</code> v1.6</p> <li><p>????</p> <li><p>Profit</p> </ol> <h2 id=run_sync ><a href="#run_sync" class=header-anchor >Run sync</a></h2> <p>Assuming you followed the post linked above<sup id="fnref:dupgdrive"><a href="#fndef:dupgdrive" class=fnref >[3]</a></sup>, and have your credentials stored in <code>~/.duplicity/credentials</code>, and a list of files to exclude stored in <code>~/.duplicity/excludes</code>,</p> <pre><code class="sh hljs">$ GOOGLE_DRIVE_SETTINGS=~/.duplicity/credentials duplicity --exclude-filelist ~/.duplicity/excludes &lt;<span class=hljs-built_in >source</span> directory&gt; <span class=hljs-string >&quot;pydrive://developer.gserviceaccount.com/&lt;Subdir on Shared Drive&gt;/?driveID=&lt;Shared Drive ID&gt;&quot;</span></code></pre>
<ul>
<li><p><code>&lt;Drive to backup&gt;</code> should be replaced with the local path to the drive you want to backup, eg <code>/lovelace/</code></p>

<li><p><code>&lt;Subdir on Shared Drive&gt;</code> should be replaced with a subdirectory on the shared drive, eg <code>lovelace</code></p>

<li><p><code>&lt;Shared Drive ID&gt;</code> should be replaced with the drive ID from google, which is the last part of the URL when you&#39;re in the team drive online, eg <code>0AAFXKrJrjeBbUk9PVA</code></p>
<p><img src="/assets/img/gdrive_shared_id.png" alt="Shared Drive ID" /></p>

</ul>
<p>I &#40;Kevin&#41; sent the decryption password to both Vanja and Shelley - hint &#61; &quot;Diamond Sutra&quot;</p>
<h2 id=downloading ><a href="#downloading" class=header-anchor >Downloading</a></h2>
<p>To restore the backup, just reverse the source and destination arguments, eg:</p>
<pre><code class="sh hljs">$ GOOGLE_DRIVE_SETTINGS=~/.duplicity/credentials duplicity --exclude-filelist ~/.duplicity/excludes <span class=hljs-string >&quot;pydrive://developer.gserviceaccount.com/&lt;Subdir on Shared Drive&gt;/?driveID=&lt;Shared Drive ID&gt;&quot;</span> &lt;destination directory&gt;</code></pre>
<h2 id=references ><a href="#references" class=header-anchor >References</a></h2>
<p><table class=fndef  id="fndef:duplicity">
    <tr>
        <td class=fndef-backref ><a href="#fnref:duplicity">[2]</a>
        <td class=fndef-content >https://launchpad.net/duplicity
    
</table>
<table class=fndef  id="fndef:dupgdrive">
    <tr>
        <td class=fndef-backref ><a href="#fnref:dupgdrive">[3]</a>
        <td class=fndef-content >https://rgarth.github.io/2017/10/29/Grive-and-Duplicity/
    
</table>
<table class=fndef  id="fndef:pass">
    <tr>
        <td class=fndef-backref ><a href="#fnref:pass">[4]</a>
        <td class=fndef-content >See <a href="pass/">this page</a> for info on setting up <code>pass</code>.
    
</table>
<table class=fndef  id="fndef:pydrive">
    <tr>
        <td class=fndef-backref ><a href="#fnref:pydrive">[5]</a>
        <td class=fndef-content >https://stackoverflow.com/a/61188575/3742902
    
</table>
<table class=fndef  id="fndef:shareddrive">
    <tr>
        <td class=fndef-backref ><a href="#fnref:shareddrive">[1]</a>
        <td class=fndef-content >https://drive.google.com/drive/u/1/folders/0AAFXKrJrjeBbUk9PVA
    
</table>
</p>
<div class=page-foot >
  <div class=copyright >
    &copy; VKC Lab Staff  | Last modified: September 22, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    </div> 
    </div> 
    </div> <!-- end of class page-wrap-->