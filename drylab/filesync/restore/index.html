<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/jtd.css"> <link rel=icon  href="/assets/favicon.ico"> <title>Restore from cloud</title> <div class=page-wrap > <div class=side-bar > <div class=header > <a href="/" class=title > VKC Lab Protocols </a> </div> <label for=show-menu  class=show-menu >MENU</label> <input type=checkbox  id=show-menu  role=button > <div class=menu  id=side-menu > <ul class=menu-list > <li class="menu-list-item "><a href="/" class="menu-list-link ">Home</a> <li class="menu-list-item "><a href="/wetlab/" class="menu-list-link ">Wet Lab Protocols</a> <li class="menu-list-item active"><a href="/drylab/" class="menu-list-link ">Dry Lab Protocols</a> <li class="menu-list-item "><a href="/handbook/" class="menu-list-link ">Lab Handbook</a> <ul class="menu-list-child-list "> <li class="menu-list-item "><a href="#ii_research_opportunities_and_expectations" class=menu-list-link >Research Expectations</a> <li class="menu-list-item "><a href="#iib_additional_expectations_for_thesis_students" class=menu-list-link >Thesis Expectations</a> <li class="menu-list-item "><a href="#iii_meetings_and_presentations" class=menu-list-link >Presentations</a> <li class="menu-list-item "><a href="#vi_agreements_and_contracts" class=menu-list-link >Agreements and Contracts</a> </ul> </ul> </div> <div class=footer > This is <em>Just the docs</em>, adapted from the <a href="https://github.com/pmarsceill/just-the-docs" target=_blank >Jekyll theme</a>. </div> </div> <div class=main-content-wrap > <div class=main-content > <div class=main-header > <a id=github  href="//github.com/Klepac-Ceraj-Lab">The VKC Lab on GitHub</a> </div> <div class=franklin-content > <p>So, everything has gone to hell, all of your hard-drives are destroyed or corrupted, Kevin is dead, incapacitated, or just not responding to email, and you need to restore files from the cloud backup.</p> <p>First, I&#39;m so sorry. Things must be in bad shape right now. Don&#39;t worry, it will be OK&#33; 🤗</p> <h2 id=set_up_machine_for_restoring_backup ><a href="#set_up_machine_for_restoring_backup" class=header-anchor >Set up machine for restoring backup 🖥️</a></h2> <p>If things are so borked that you need the cloud backup, there&#39;s a good chance you&#39;ll need to re-install the software.</p> <p>Go back to <a href="../#setting_up_duplicity">this page</a> and make sure you have</p> <ol> <li><p>Installed <code>duplicity</code></p> <li><p>Set up a developer app with read/write credentials &#40;for this part, you only need read&#41;</p> <li><p>Installed <code>pydrive</code> and other dependencies</p> <li><p>Remember the decryption password &#40;Diamond sutra&#41;</p> </ol> <h2 id=downloading ><a href="#downloading" class=header-anchor >Downloading 🔽</a></h2> <h3 id=identify_drive_to_restore ><a href="#identify_drive_to_restore" class=header-anchor ><ol> <li><p>Identify drive to restore</p> </ol> </a></h3> <p>All of the lab drives are stored in the same <a href="https://drive.google.com/drive/u/1/folders/0AAFXKrJrjeBbUk9PVA">google shared drive</a>, with drive ID <code>0AAFXKrJrjeBbUk9PVA</code> &#40;the last part of the URL above&#41;.</p> <p>Find the name of the directory that you need to restore &#40;for a list of lab severs and their hard drives, <a href="../../computers">see here</a>&#41;. For example, if you are restoring the 8 Gb drive on <code>ada</code>, you will use <code>lovelace</code>.</p> <h3 id=ol_start2_find_the_path_to_your_google_credentials ><a href="#ol_start2_find_the_path_to_your_google_credentials" class=header-anchor ><ol start=2 > <li><p>Find the path to your google credentials</p> </ol> </a></h3> <p>From <a href="https://rgarth.github.io/2017/10/29/Grive-and-Duplicity/">this tutorial</a>, you should have saved your google app credentials somewhere like <code>~/.duplicity/credentials</code>:</p> <pre><code class="sh hljs">❯ <span class=hljs-built_in >cat</span> ~/.duplicity/credentials
───────┬────────────────────────────────────────────────────────────────
       │ File: .duplicity/credentials
───────┼────────────────────────────────────────────────────────────────
   1   │ client_config_backend: settings
   2   │ client_config:
   3   │    client_id: {{LONG ALPHANUMERIC STRING - HIDDEN}}
   4   │    client_secret: {{SHORTER ALPHANUMERIC STRING - HIDDEN}}
   5   │ save_credentials: True
   6   │ save_credentials_backend: file
   7   │ save_credentials_file: gdrive.cache
   8   │ get_refresh_token: True</code></pre> <h3 id=ol_start3_use_duplicity_to_sync ><a href="#ol_start3_use_duplicity_to_sync" class=header-anchor ><ol start=3 > <li><p>Use duplicity to sync</p> </ol> </a></h3> <p>In the following command, replace:</p> <ul> <li><p><code>&#36;DRIVEID</code> with the shared drive ID, eg <code>0AAFXKrJrjeBbUk9PVA</code>, from <a href="#identify_drive_to_restore">step 1</a></p> <li><p><code>&#36;SUBDIR</code> with the name of the directory you&#39;re restoring, eg <code>lovelace</code>, from <a href="#identify_drive_to_restore">step 1</a></p> <li><p><code>&#36;CREDENTIALS</code> with the path to your google credentials, eg <code>~/.duplicity/credentials</code> from <a href="#ol_start2_find_the_path_to_your_google_credentials">step 2</a></p> <li><p><code>&#36;DESTDIR</code> with the path on your local system that you want to restore to. Eg <code>/lovelace/</code></p> </ul> <pre><code class="sh hljs">$ <span class=hljs-built_in >export</span> GOOGLE_DRIVE_SETTINGS=<span class=hljs-variable >$CREDENTIALS</span>
$ duplicity <span class=hljs-string >&quot;pydrive://developer.gserviceaccount.com/<span class=hljs-variable >$SUBDIR</span>/?driveID=<span class=hljs-variable >$DRIVEID</span>&quot;</span> <span class=hljs-variable >$DESTDIR</span></code></pre> <p>So, following the examples above, if you want to restore the <code>lovelace</code> subdirectory to the <code>/lovelace/</code> path on <code>ada</code>, you might do:</p> <pre><code class="sh hljs">$ <span class=hljs-built_in >export</span> GOOGLE_DRIVE_SETTINGS=~/.duplicity/credentials
$ duplicity <span class=hljs-string >&quot;pydrive://developer.gserviceaccount.com/lovelace/?driveID=0AAFXKrJrjeBbUk9PVA&quot;</span> /lovelace/</code></pre> <h3 id=ol_start4_authenticate_possibly ><a href="#ol_start4_authenticate_possibly" class=header-anchor ><ol start=4 > <li><p>Authenticate &#40;possibly&#41;</p> </ol> </a></h3> <p>You may be asked to authenticate via your browser. Eg - there will be a prompt like:</p> <pre><code class="julia hljs">Go to the following link <span class=hljs-keyword >in</span> your browser:

    https://accounts.google.com/o/oauth2/auth?client_id={{STUFF}}.apps.googleusercontent.com&amp;redirect_uri={{SOME_OTHER_STUFF}}%<span class=hljs-number >2</span>Fauth%<span class=hljs-number >2</span>Fdrive&amp;access_type=offline&amp;response_type=code&amp;approval_prompt=force

Enter verification code:</code></pre> <p>Copy the text of the url and paste it into a browser, then sign in to your Wellesely account, and click &quot;approve.&quot; There will then be a long alphanumeric string that you need to copy and paste back in your terminal.</p> <h3 id=ol_start5_enter_encryption_password ><a href="#ol_start5_enter_encryption_password" class=header-anchor ><ol start=5 > <li><p>Enter encryption password</p> </ol> </a></h3> <p>You will then be prompted to enter the encryption password twice.</p> <div class=page-foot > <div class=copyright > &copy; VKC Lab Staff | Last modified: December 09, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div> </div> </div> <!-- end of class page-wrap-->